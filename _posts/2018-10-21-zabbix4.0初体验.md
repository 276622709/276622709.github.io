---
layout: post
title: zabbix4.0初体验
date: 2018-10-21
author: ZMY
header-img: img/monitor_alarm_background4.gif
tags:
    - zabbix
---

## <img class="original" src='https://raw.githubusercontent.com/276622709/276622709.github.io/master/img/original.png'> zabbix4.0初体验

## 背景
听说最近zabbix更新到4.0版本了，赶紧下载安装实验一下功能 
## 目的
使用zabbix4.0监控服务器的状态，由于环境原因客户端只能使用active agent模式，最后告警通过邮件和微信形式进行通知  
## 环境  
zabbix服务器端10.254.0.220    
zabbix客户端  192.168.141.242    
zabbix客户端经过NAT设备访问zabbix服务器端    
系统环境是CentOS Linux release 7.2.1511 (Core)
本来想要跟随着官网document搭建，但是官网文档只有3.4版本，因此就跟着3.4的版本来，操作的时候就安装包名称路径由3.4换成4.0就可以了  
由于centos7开始安装的mysql默认为miriadb,自己看起来别扭，还是下载mysql原生版本用起来比较自然  
##  安装和配置过程
``` code 
wget https://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm  #下载官网repo安装文件  
rpm -ivh mysql57-community-release-el7-9.noarch.rpm  #安装repo文件  
yum install mysql-server -y  #yum安装  
systemctl start mysqld  #启动mysql服务  
systemctl enable mysqld #设置开机启动  
grep 'temporary password' /var/log/mysqld.log #获取安装时的临时密码  
(这里可能有之前安装过mysql的，在这一步获取不到临时密码，下面是解决办法  
rm -rf /var/lib/mysql  #删除原来mysql残留的数据  
systemctl restart mysqld  #重启mysql服务  
grep 'temporary password' /var/log/mysqld.log  #再去找临时密码)  
mysql -u root -p      #登录，提示输入密码，输入之前在/var/log/mysqld.log中获取的临时密码 
set password=password("yourpassword");  #登录成功后修改密码
```
以上步骤只是成功安装mysql5.7并初始化root账户设置密码，下面开始进入zabbix的安装与配置  
```code
rpm -ivh http://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm #安装zabbix yum源  
yum install zabbix-server-mysql zabbix-web-mysql -y #安装zabbix安装包
```
在mysql上安装zabbix数据库和用户(password换成自己设置的密码)
```code
mysql -u root -p<password> #登录mysql  
create database zabbix character set utf8 collate utf8_bin; #设置zabbix编码方式为utf-8  
grant all privileges on zabbix.* to zabbix@localhost identified by '<password>';  #授权zabbix用户权限  
flush privileges;  #使权限设置生效
quit； 退出  
```
然后导入初始架构（Schema）和数据  
```code
cd /usr/share/doc/zabbix-server-mysql-4.0.0/
gzip -d create.sql.gz 
mysql -u root -p'yourpassword' zabbix < create.sql 
```
在zabbix_server.conf中编辑数据库配置
```code
#vi /etc/zabbix/zabbix_server.conf
DBHost=localhost
DBName=zabbix
DBUser=zabbix
DBPassword=yourpassword
```
启动Zabbix Server进程
```code
# systemctl start zabbix-server
```
编辑Zabbix前端的PHP配置  
Zabbix前端的Apache配置文件位于 /etc/httpd
